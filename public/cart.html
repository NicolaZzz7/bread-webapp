<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõí –ö–æ—Ä–∑–∏–Ω–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõí –ö–æ—Ä–∑–∏–Ω–∞</h1>
            <p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤</p>
        </div>

        <div id="cartGrid" class="product-grid">
            <div class="loading">
                <div class="spinner">‚è≥</div>
                <div>–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É...</div>
            </div>
        </div>

        <div class="modal-summary">
            <div class="summary-item total">
                <span>–ò—Ç–æ–≥–æ:</span>
                <span id="cartTotal">0‚ÇΩ</span>
            </div>
        </div>

        <button class="add-to-cart-btn" id="checkoutBtn" onclick="checkout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>

    <script src="/script.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ cart.html
        document.addEventListener('DOMContentLoaded', function() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            renderCart(cart);
            updateCartTotal();
        });

        function renderCart(cart) {
            const grid = document.getElementById('cartGrid');
            if (!cart || cart.length === 0) {
                grid.innerHTML = getEmptyStateHTML('üõí', '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞', '–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞');
                return;
            }
            grid.innerHTML = cart.map(item =>
                `<div class="product-card">
                    <div class="product-header">
                        <div class="product-emoji">${item.emoji}</div>
                        <div class="product-info">
                            <div class="product-name">${item.name} (${item.weight}–≥) ${item.hasAddons ? '—Å –¥–æ–±–∞–≤–∫–∞–º–∏' : ''}</div>
                            <div class="product-ingredients">x${item.quantity} - ${item.total}‚ÇΩ</div>
                        </div>
                        <button class="add-button" onclick="removeFromCart('${item.id}', '${item.weight}')">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>`
            ).join('');
        }

        function removeFromCart(productId, weight) {
            cart = cart.filter(item => !(item.id === productId && item.weight === weight));
            saveCart();
            renderCart(cart);
            updateCartTotal();
            updateCartIndicator();
        }

        function updateCartTotal() {
            const total = getTotalPrice();
            document.getElementById('cartTotal').textContent = `${total}‚ÇΩ`;
        }

        function checkout() {
            if (cart.length === 0) {
                alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
                return;
            }
            Telegram.WebApp.sendData(JSON.stringify({
                action: 'checkout',
                cart: cart,
                total: getTotalPrice(),
                totalItems: getTotalItems()
            }));
        }
    </script>
</body>
</html>